Sap Flow Pipeline README

Repo name: sap_flow_pipeline
Repo url: https://github.com/singley-sci/sap_flow_pipeline.git

Creators: Joel Singley, Isaac Fry, Luke Jacobsen, and Annie Tucker

Purpose: Development of coding tools for processing and analyzing high-frequency sap flow data. This includes data ingestion, zero flow correction, and gap flagging and filling. Additional *draft* scripts for trend analysis and temporal moment analysis are included as well.

Structure: This repo is designed around a general three sub-directory system. The "src" folder should contain scripts; the "data" folder contains data inputs and processed outputs from the code; and the "docs" folder should contain markdown files, reports, and plots generated by those scripts. Note that the .gitignore is set to exclude the all files and subdirectories within the data folder.
For the Sierra BCZN project, within the "data" folder, there are 2 folders: "processed" (initially empty) and "Sierra_BCZN" (containing raw data organized in folders). An example successful file path for this project is "...\sap_flow_pipeline\data\Sierra_BCZN\June2022\StationData\P304_B\P304_B_20220621" If using this R Project for a different project, adjust the files paths as-needed throughout the scripts.

NOTE: "plots" = field station, i.e., in there are 6 plots within the Sierra BCZN project
NOTE: "probes" = individual sap flow sensor, i.e., there are about 4 probes at each station (a, b, c, d)

Raw data sources: the soil moisture data was collected from METER EC-5. The RH data is from Onset HOBOs. The sap flow data is from Implexx Gen 2, with data collected and stored on a Campbell Scientific. The raw files from snow, sap flow, and soil moisture should be in the .dat file format (from the Campbell). The RH raw files can be in .xlsx or .csv (from HOBO).

Sequence of Scripts & Notes: 
1 - Run ingest scripts first (soil_moisture_ingest, sap_flow_ingest, snow_depth_ingest, and MET_RH_ingest) to produce preliminary soil moisture, sap flow, RH, snow-depth, and MET csv files.
	Ensure you have a "processed" folder.
	**If running this code for a different project, adjust or skip the iterative_access function.

2 - Run data_issue_corrections to produce master soil moisture, RH, snow depth, and MET csv files and a fixed sap-flow csv file.
	This file contains Sierra BCZN-specific data corrections, such as adjusting labels, filtering data, and gap filling.
	**If running this code for a different project, skip this script but adjust the sap flow csv file from "sap_flow_prelim.csv" to be called "sap_flow_fixed.csv" in order for the next scripts to work.

3 - Run sap_flow_QA to produce a QA'd sap flow csv file.
	This file removes outliers.
	**If running this code for a different project, no changes needed.

4 - Run sap_flow_corrections to produce a master sap flow csv file.
	This code calculates heat velocity via HRM, corrects for probe misalignment by identifying multiple zeroing events and interpolating the offset needed between zeroing events, and finally calculates sap velocity from heat velocity. To run this code, you need VPD data for the misalignment correction.
	**If running this code for a different project, some adjustments may be needed if tree core data is not accessible (see script and comments). Also, verify that the parameters set at the top of the script apply. Also, "plot" and "probe" are specific to Sierra BCZN, and the code indexes with them many times, so that may need to be adjusted.

4 - There is another script (data_vis) to plot the master files.


Python_SF_Scripts
additional scripts for updated zeroing using python script based on Zeppel et al. and for converting heat velocity to sap velocity
